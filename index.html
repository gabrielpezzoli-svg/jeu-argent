<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VaultX Casino</title>
<style>
body { background:#000; color:#0f0; font-family:Arial; text-align:center; }
.screen { display:none; }
.active { display:block; }
button { padding:10px; margin:5px; }
input { padding:8px; margin:5px; }
</style>
</head>

<body>

<div id="authScreen" class="screen active">
<h2>Connexion</h2>
<input id="liU" placeholder="Pseudo">
<input id="liP" type="password" placeholder="Mot de passe">
<button onclick="doLogin()">Login</button>

<h2>Inscription</h2>
<input id="rgU" placeholder="Pseudo">
<input id="rgP" type="password" placeholder="Mot de passe">
<button onclick="doRegister()">Register</button>
</div>

<div id="gameScreen" class="screen">
<h2>Bienvenue <span id="userD"></span></h2>
<h3>Balance: <span id="balD">0</span> VLX</h3>
<button onclick="playSlot()">ðŸŽ° Jouer (100 VLX)</button>
</div>


<script type="module">

// Firebase imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// CONFIG
const firebaseConfig = {
  apiKey: "AIzaSyD7GTADWbWIABs5KxyPr-P5IXyYKyfHjnY",
  authDomain: "chat-souris-484f4.firebaseapp.com",
  databaseURL: "https://chat-souris-484f4-default-rtdb.firebaseio.com",
  projectId: "chat-souris-484f4",
  storageBucket: "chat-souris-484f4.firebasestorage.app",
  messagingSenderId: "486094041070",
  appId: "1:486094041070:web:15e1b625315f3519ad68ff"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

let currentUser = null;
let balance = 0;

// REGISTER
window.doRegister = async function() {
  const u = rgU.value;
  const p = rgP.value;
  const email = u + "@vaultx.com";

  await createUserWithEmailAndPassword(auth, email, p);
  await set(ref(db, "users/" + u), { balance: 1500 });

  alert("Compte crÃ©Ã© avec 1500 VLX");
};

// LOGIN
window.doLogin = async function() {
  const u = liU.value;
  const p = liP.value;
  const email = u + "@vaultx.com";

  await signInWithEmailAndPassword(auth, email, p);
  currentUser = u;
  loadUser();
};

// LOAD USER DATA
async function loadUser() {
  const snap = await get(ref(db, "users/" + currentUser));
  if (!snap.exists()) return alert("Erreur donnÃ©es");

  balance = snap.val().balance;

  authScreen.classList.remove("active");
  gameScreen.classList.add("active");
  userD.innerText = currentUser;
  balD.innerText = balance;
}

// SLOT GAME
window.playSlot = async function() {
  if (balance < 100) return alert("Pas assez d'argent");

  balance -= 100;

  let win = Math.random() < 0.3 ? 300 : 0;
  balance += win;

  balD.innerText = balance;

  await update(ref(db, "users/" + currentUser), { balance });

  alert(win > 0 ? "ðŸŽ‰ GagnÃ© 300 VLX" : "Perdu");
};

</script>
</body>
</html>
