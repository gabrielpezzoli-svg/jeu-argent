<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VAULTEX — Casino Virtuel</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<style>
body{background:#07070f;color:#d0d0f0;font-family:sans-serif;margin:0;padding:0;}
.screen{display:none;min-height:100vh;align-items:center;justify-content:center;flex-direction:column;}
.screen.active{display:flex;}
.auth-card{background:#121226;padding:40px;border-radius:20px;width:400px;text-align:center;}
.field{margin-bottom:16px;}
.field input{width:100%;padding:10px;border-radius:8px;border:none;background:#0d0d1c;color:#fff;}
.auth-btn{width:100%;padding:12px;border:none;border-radius:8px;background:#e8b84b;color:#000;font-weight:bold;cursor:pointer;}
#balance{font-size:24px;margin-bottom:20px;}
#leaderboard ol{padding:0;list-style:none;}
#leaderboard li{background:#0f0f20;margin:4px 0;padding:10px;border-radius:8px;display:flex;justify-content:space-between;}
</style>
</head>
<body>

<!-- AUTH -->
<div id="authScreen" class="screen active">
  <div class="auth-card">
    <h2>VAULTEX CASINO</h2>
    <div id="fLogin">
      <div class="field"><input id="liU" type="text" placeholder="Pseudo"/></div>
      <div class="field"><input id="liP" type="password" placeholder="Mot de passe"/></div>
      <button class="auth-btn" onclick="doLogin()">Se connecter</button>
      <p>Pas encore de compte ? <a href="#" onclick="switchAuth('reg')">S’inscrire</a></p>
    </div>
    <div id="fReg" style="display:none;">
      <div class="field"><input id="rgU" type="text" placeholder="Pseudo"/></div>
      <div class="field"><input id="rgP" type="password" placeholder="Mot de passe"/></div>
      <button class="auth-btn" onclick="doRegister()">Créer un compte</button>
      <p>Déjà un compte ? <a href="#" onclick="switchAuth('login')">Se connecter</a></p>
    </div>
  </div>
</div>

<!-- GAME -->
<div id="gameScreen" class="screen">
  <div id="balance">Argent: 0 VLX</div>
  <div id="leaderboard">
    <h2>Top 20 joueurs</h2>
    <ol id="leaderboardList"></ol>
  </div>
</div>

<script>
// --- Firebase Config ---
const firebaseConfig = {
  apiKey: "VOTRE_API_KEY",
  authDomain: "VOTRE_PROJET.firebaseapp.com",
  databaseURL: "https://VOTRE_PROJET.firebaseio.com",
  projectId: "VOTRE_PROJET",
  storageBucket: "VOTRE_PROJET.appspot.com",
  messagingSenderId: "VOTRE_SENDER_ID",
  appId: "VOTRE_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// --- Auth Switch ---
function switchAuth(tab){
  document.getElementById('fLogin').style.display = tab==='login'?'block':'none';
  document.getElementById('fReg').style.display = tab==='reg'?'block':'none';
}

// --- Encode pseudo pour email Firebase ---
function pseudoToEmail(pseudo){
  return encodeURIComponent(pseudo.trim())+'@vaultex.com';
}

// --- Register ---
function doRegister(){
  const pseudo = document.getElementById('rgU').value.trim();
  const pass = document.getElementById('rgP').value.trim();
  if(!pseudo || !pass) return alert('Remplissez tous les champs');
  const email = pseudoToEmail(pseudo);
  auth.createUserWithEmailAndPassword(email, pass)
    .then(cred=>{
      db.ref('users/'+cred.user.uid).set({pseudo:pseudo,balance:1500});
      alert('Compte créé ! Vous recevez 1500 VLX.');
      document.getElementById('rgU').value=''; document.getElementById('rgP').value='';
      switchAuth('login');
    })
    .catch(e=>alert(e.message));
}

// --- Login ---
function doLogin(){
  const pseudo = document.getElementById('liU').value.trim();
  const pass = document.getElementById('liP').value.trim();
  if(!pseudo || !pass) return alert('Remplissez tous les champs');
  const email = pseudoToEmail(pseudo);
  auth.signInWithEmailAndPassword(email, pass)
    .then(cred=>{
      document.getElementById('authScreen').classList.remove('active');
      document.getElementById('gameScreen').classList.add('active');
      loadUser(cred.user.uid);
    })
    .catch(e=>alert(e.message));
}

// --- Load User ---
let currentUserId=null;
function loadUser(uid){
  currentUserId=uid;
  const userRef = db.ref('users/'+uid);
  userRef.on('value', snap=>{
    if(snap.exists()){
      document.getElementById('balance').innerText = 'Argent: '+snap.val().balance+' VLX';
      updateLeaderboard();
    }
  });
}

// --- Leaderboard ---
function updateLeaderboard(){
  db.ref('users').orderByChild('balance').limitToLast(20).once('value', snap=>{
    const list=document.getElementById('leaderboardList');
    list.innerHTML='';
    const arr=[];
    snap.forEach(u=>arr.push(u.val()));
    arr.reverse();
    arr.forEach(user=>{
      const li=document.createElement('li');
      li.textContent=user.pseudo+' — '+user.balance+' VLX';
      list.appendChild(li);
    });
  });
}
</script>

</body>
</html>
